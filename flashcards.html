<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Daddy's Bilingual Dictation</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<style>
  /* --- CSS STYLES --- */
  :root {
    --primary: #00838F;
    --accent: #FF9800;
    --bg-grad: linear-gradient(135deg, #E0F7FA 0%, #80DEEA 100%);
    --font: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
  }

  body {
    margin: 0; background: var(--bg-grad); font-family: var(--font);
    min-height: 100vh; display: flex; flex-direction: column;
    align-items: center; justify-content: center; text-align: center;
    color: #006064; overflow-x: hidden;
  }

  .screen {
    display: none; width: 90%; max-width: 600px; flex-direction: column;
    align-items: center; padding: 20px; box-sizing: border-box;
    animation: fadeIn 0.5s ease;
  }
  .active { display: flex; }

  @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

  h1 { font-size: 2.2rem; margin: 0 0 20px 0; color: #006064; }
  p { font-size: 1.1rem; color: #006064; opacity: 0.8; }

  /* Inputs */
  textarea {
    width: 100%; height: 150px; padding: 15px; font-size: 1.1rem;
    border-radius: 15px; border: 2px solid var(--primary); margin-bottom: 20px;
    font-family: inherit; resize: vertical;
  }

  input[type="text"] {
    width: 100%; padding: 15px; font-size: 1.5rem; border-radius: 50px;
    border: 3px solid var(--primary); text-align: center; margin: 20px 0; outline: none;
  }
  input[type="text"]:focus { border-color: var(--accent); }

  /* Dropdown for Language */
  select {
    padding: 10px; font-size: 1.1rem; border-radius: 10px;
    border: 2px solid var(--primary); margin-bottom: 15px; background: white; width: 100%;
  }

  /* Buttons */
  button {
    border: none; border-radius: 50px; cursor: pointer; font-weight: bold;
    font-family: inherit; transition: all 0.2s; margin: 5px;
  }
  button:active { transform: scale(0.95); }

  .btn-primary {
    background: var(--accent); color: white; font-size: 1.4rem;
    padding: 15px 40px; box-shadow: 0 4px 15px rgba(255,152,0,0.4); width: 100%;
  }
  
  .btn-secondary {
    background: var(--primary); color: white; font-size: 1.1rem; padding: 12px 25px;
  }
  
  .btn-skip { background: #546E7A; color: white; padding: 10px 20px; }
  .btn-peek { background: #E91E63; color: white; padding: 10px 25px; display: none; }
  .btn-text { background: transparent; color: #006064; text-decoration: underline; margin-top: 20px; }

  /* Game UI */
  .progress-container { width: 100%; background: rgba(255,255,255,0.5); height: 10px; border-radius: 5px; margin-bottom: 20px; overflow: hidden; }
  .progress-bar { height: 100%; background: var(--primary); width: 0%; transition: width 0.3s ease; }

  #feedback { font-size: 1.8rem; font-weight: bold; min-height: 2.5rem; margin: 10px 0; }
  .feedback-correct { color: #2E7D32; }
  .feedback-wrong { color: #C62828; }
  .feedback-info { color: #1565C0; }

  canvas { position: fixed; top: 0; left: 0; pointer-events: none; z-index: 999; }
</style>
</head>
<body>

<div id="setupScreen" class="screen active">
  <h1>Dictation Setup üìù</h1>
  
  <div style="width:100%; text-align:left; margin-bottom:5px; font-weight:bold;">Subject Language:</div>
  <select id="langSelect">
      <option value="en-GB">üá¨üáß English (British)</option>
      <option value="zh-HK">üá≠üá∞ Cantonese (HK)</option>
      <option value="zh-CN">üá®üá≥ Mandarin (Putonghua)</option>
  </select>

  <p>Type list below (one per line):</p>
  <textarea id="wordListInput" placeholder="Example:&#10;Apple&#10;ËòãÊûú&#10;ËÄÅÂ∏´"></textarea>
  
  <button class="btn-primary" onclick="startGame()">Start Dictation ‚ñ∂</button>
  <button class="btn-text" onclick="clearStorage()">Clear Saved List</button>
</div>

<div id="gameScreen" class="screen">
  <div style="font-size:1.1rem; font-weight:bold; margin-bottom:5px;">
    Word <span id="currentNum">1</span> of <span id="totalNum">0</span>
  </div>
  <div class="progress-container"><div id="progressBar" class="progress-bar"></div></div>
  
  <div id="feedback">Press Listen</div>
  
  <input type="text" id="kidInput" placeholder="Type answer here..." autocomplete="off">
  
  <div style="display:flex; gap:10px; justify-content:center; flex-wrap:wrap; width:100%;">
    <button class="btn-secondary" onclick="speakCurrent()">üîä Listen</button>
    <button class="btn-primary" style="width:auto; min-width:120px;" onclick="checkAnswer()">‚úî Check</button>
  </div>

  <div style="margin-top: 15px;">
      <button id="peekBtn" class="btn-peek" onclick="revealAnswer()">üëÄ Show Answer?</button>
      <button class="btn-skip" onclick="skipWord()">‚è© Skip Next</button>
  </div>
  
  <button class="btn-text" onclick="editList()">‚úé Edit List</button>
</div>

<div id="winScreen" class="screen">
  <h1 style="font-size:4rem; margin-bottom:10px;">üèÜ</h1>
  <h1>Great Job!</h1>
  <button class="btn-primary" onclick="editList()">Play Again</button>
</div>

<canvas id="confetti"></canvas>
<audio id="snd_win" src="https://www.soundjay.com/misc/success-1.mp3"></audio>
<audio id="snd_clap" src="https://www.soundjay.com/human/applause-01.mp3"></audio>

<script>
  // --- STATE ---
  let words = [];
  let currentIndex = 0;
  let selectedLang = 'en-GB';

  // --- INIT ---
  window.onload = function() {
    const savedWords = localStorage.getItem('daddyDictationWords');
    const savedLang = localStorage.getItem('daddyDictationLang');
    
    if (savedWords) document.getElementById('wordListInput').value = savedWords;
    if (savedLang) document.getElementById('langSelect').value = savedLang;
  };

  // --- FUNCTIONS ---
  function startGame() {
    const rawText = document.getElementById('wordListInput').value;
    words = rawText.split('\n').map(w => w.trim()).filter(w => w.length > 0);
    selectedLang = document.getElementById('langSelect').value;

    if (words.length === 0) { alert("Please type at least one word!"); return; }

    // Save Logic
    localStorage.setItem('daddyDictationWords', rawText);
    localStorage.setItem('daddyDictationLang', selectedLang);

    currentIndex = 0;
    document.getElementById('totalNum').innerText = words.length;
    updateProgress();
    
    showScreen('gameScreen');
    prepareRound();
    setTimeout(speakCurrent, 600);
  }

  function prepareRound() {
    document.getElementById('kidInput').value = '';
    document.getElementById('feedback').innerText = "Listen & Type";
    document.getElementById('feedback').className = "";
    document.getElementById('peekBtn').style.display = 'none';
    document.getElementById('kidInput').focus();
  }

  function speakCurrent() {
    const txt = words[currentIndex];
    const u = new SpeechSynthesisUtterance(txt);
    
    // USES THE SELECTED LANGUAGE (Cantonese or English)
    u.lang = selectedLang; 
    
    u.rate = 0.8;
    speechSynthesis.speak(u);
    document.getElementById('kidInput').focus();
  }

  function checkAnswer() {
    const kidTyped = document.getElementById('kidInput').value.trim();
    const correctWord = words[currentIndex];

    if (!kidTyped) { document.getElementById('feedback').innerText = "Type something!"; return; }

    // For Chinese, case doesn't matter, but good to keep .toLowerCase() for English mixing
    if (kidTyped.toLowerCase() === correctWord.toLowerCase()) {
      handleCorrect();
    } else {
      handleWrong();
    }
  }

  function handleCorrect() {
    document.getElementById('feedback').innerHTML = "Correct! ‚òÖ";
    document.getElementById('feedback').className = "feedback-correct";
    document.getElementById('peekBtn').style.display = 'none';
    document.getElementById('snd_clap').play();
    confettiBurst('#4CAF50');
    setTimeout(() => {
      currentIndex++;
      if (currentIndex >= words.length) victory();
      else { updateProgress(); prepareRound(); setTimeout(speakCurrent, 300); }
    }, 1500);
  }

  function handleWrong() {
    document.getElementById('feedback').innerHTML = "Try again!";
    document.getElementById('feedback').className = "feedback-wrong";
    document.getElementById('peekBtn').style.display = 'inline-block';
    speakCurrent();
  }

  function revealAnswer() {
      const correctWord = words[currentIndex];
      const feedback = document.getElementById('feedback');
      feedback.innerHTML = "It is: <br><b>" + correctWord + "</b>";
      feedback.className = "feedback-info";
      document.getElementById('kidInput').focus();
  }

  function skipWord() {
      currentIndex++;
      if (currentIndex >= words.length) victory();
      else { updateProgress(); prepareRound(); setTimeout(speakCurrent, 300); }
  }

  function updateProgress() {
    document.getElementById('currentNum').innerText = currentIndex + 1;
    document.getElementById('progressBar').style.width = ((currentIndex) / words.length) * 100 + "%";
  }

  function victory() {
    showScreen('winScreen');
    document.getElementById('snd_win').play();
    confettiBurst();
  }

  function editList() { showScreen('setupScreen'); }
  
  function clearStorage() {
    if(confirm("Delete saved list?")) {
      localStorage.removeItem('daddyDictationWords');
      document.getElementById('wordListInput').value = '';
    }
  }

  function showScreen(id) {
    document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
    document.getElementById(id).classList.add('active');
  }

  function confettiBurst(col = null) {
    const c = document.getElementById('confetti'); c.style.display='block';
    c.width = window.innerWidth; c.height = window.innerHeight;
    const ctx = c.getContext('2d');
    const cols = col ? [col] : ['#F44336','#2196F3','#FFEB3B','#4CAF50','#9C27B0'];
    const p = Array.from({length:250},()=>({x:c.width/2,y:c.height/2,c:cols[Math.floor(Math.random()*cols.length)],a:Math.random()*6.28,v:Math.random()*10+5,s:Math.random()*10+4,d:0.95}));
    let f=0;
    const anim = setInterval(() => {
        ctx.clearRect(0, 0, c.width, c.height);
        p.forEach(o => { o.x+=Math.cos(o.a)*o.v; o.y+=Math.sin(o.a)*o.v+3; o.v*=o.d; ctx.fillStyle=o.c; ctx.fillRect(o.x,o.y,o.s,o.s); });
        if (++f>60) { clearInterval(anim); c.style.display='none'; }
    }, 30);
  }
</script>
</body>
</html>
