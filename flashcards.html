<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>Daddy's Smart Dictation</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<style>
  /* Base Styles */
  body {margin:0;background:linear-gradient(#E0F7FA,#80DEEA);font-family:'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;min-height:100vh;display:flex;flex-direction:column;align-items:center;text-align:center;color:#006064;}
  
  /* Screens */
  .screen {display:none; width:90%; max-width:600px; flex-direction:column; align-items:center; padding-top: 5vh;}
  .active {display:flex;}

  h1 {font-size:2.5rem; margin-bottom:20px; color:#006064;}
  h2 {margin-top:0; color:#00838F;}
  
  /* Inputs */
  textarea {width:100%; height:200px; padding:15px; font-size:1.2rem; border-radius:15px; border:2px solid #00838F; margin-bottom:20px; font-family:inherit;}
  input[type="text"] {width:100%; padding:15px; font-size:1.5rem; border-radius:50px; border:3px solid #00838F; text-align:center; margin:20px 0; outline:none;}
  
  /* Buttons */
  button {border:none; border-radius:50px; cursor:pointer; font-weight:bold; transition:transform 0.1s, box-shadow 0.1s; margin:5px;}
  button:active {transform:scale(0.98);}
  
  .btn-primary {background:#FF9800; color:white; font-size:1.5rem; padding:15px 40px; box-shadow:0 4px 15px rgba(255,152,0,0.4); width: 100%;}
  .btn-secondary {background:#00838F; color:white; font-size:1.2rem; padding:12px 30px; box-shadow:0 4px 10px rgba(0,131,143,0.3);}
  .btn-text {background:transparent; color:#006064; text-decoration:underline; font-size:1rem; margin-top:20px;}

  /* Game Elements */
  #status {font-size:1.2rem; margin-bottom:10px; font-weight:bold;}
  #feedback {font-size:2rem; font-weight:bold; min-height:3rem; margin:10px 0;}
  .correct {color:#2E7D32;}
  .wrong {color:#C62828;}
  
  /* Visuals */
  canvas {position:fixed;top:0;left:0;pointer-events:none;z-index:999;}
  
  .progress-container {width:100%; background:#fff; height:10px; border-radius:5px; margin-bottom:20px; overflow:hidden;}
  .progress-bar {height:100%; background:#00838F; width:0%; transition:width 0.3s;}
</style>
</head>
<body>

<div id="setupScreen" class="screen active">
  <h1>Dictation Setup üìù</h1>
  <p>Enter words below (one per line).<br>They will be saved automatically.</p>
  <textarea id="wordListInput" placeholder="Example:&#10;Apple&#10;Banana&#10;The cat sat."></textarea>
  <button class="btn-primary" onclick="startGame()">Start Dictation ‚ñ∂</button>
  <button class="btn-text" onclick="clearStorage()">Clear Saved List</button>
</div>

<div id="gameScreen" class="screen">
  <div id="status">Word <span id="currentNum">1</span> of <span id="totalNum">0</span></div>
  <div class="progress-container"><div id="progressBar" class="progress-bar"></div></div>
  
  <div id="feedback">Listen & Type</div>
  
  <input type="text" id="kidInput" placeholder="Type here..." autocomplete="off">
  
  <div style="display:flex; gap:10px; justify-content:center; flex-wrap:wrap;">
    <button class="btn-secondary" onclick="speakCurrent()">üîä Listen</button>
    <button class="btn-primary" style="width:auto" onclick="checkAnswer()">‚úî Check</button>
  </div>
  
  <button class="btn-text" onclick="editList()">‚úé Edit List</button>
</div>

<div id="winScreen" class="screen">
  <h1 style="font-size:4rem">YOU DID IT! üèÜ</h1>
  <p>All words correct!</p>
  <button class="btn-primary" onclick="editList()">Play Again</button>
</div>

<canvas id="confetti"></canvas>
<audio id="snd_win" src="https://www.soundjay.com/misc/success-1.mp3"></audio>
<audio id="snd_clap" src="https://www.soundjay.com/human/applause-01.mp3"></audio>

<script>
  // --- LOGIC ---
  let words = [];
  let currentIndex = 0;

  // 1. On Load: Check if words are saved
  window.onload = function() {
    const saved = localStorage.getItem('daddyDictationWords');
    if (saved) {
      document.getElementById('wordListInput').value = saved;
    }
  };

  // 2. Start the Game
  function startGame() {
    const rawText = document.getElementById('wordListInput').value;
    // Split by new lines, remove empty lines, trim whitespace
    words = rawText.split('\n').map(w => w.trim()).filter(w => w.length > 0);

    if (words.length === 0) {
      alert("Please enter at least one word!");
      return;
    }

    // Save to browser memory
    localStorage.setItem('daddyDictationWords', rawText);

    // Reset Game State
    currentIndex = 0;
    document.getElementById('totalNum').innerText = words.length;
    updateProgress();
    
    // Switch Screens
    showScreen('gameScreen');
    
    // Prepare first word
    document.getElementById('kidInput').value = '';
    document.getElementById('feedback').innerText = "Press Listen";
    document.getElementById('feedback').className = "";
    
    // Auto speak after short delay
    setTimeout(speakCurrent, 500);
  }

  function speakCurrent() {
    const txt = words[currentIndex];
    const u = new SpeechSynthesisUtterance(txt);
    u.lang = 'en-GB'; // British English
    u.rate = 0.85;    // Slightly slower for clarity
    speechSynthesis.speak(u);
    document.getElementById('kidInput').focus();
  }

  function checkAnswer() {
    const kidTyped = document.getElementById('kidInput').value.trim();
    const correctWord = words[currentIndex];

    // Case insensitive comparison
    if (kidTyped.toLowerCase() === correctWord.toLowerCase()) {
      // Correct!
      document.getElementById('feedback').innerHTML = "Correct! ‚òÖ";
      document.getElementById('feedback').className = "correct";
      document.getElementById('snd_clap').play();
      confettiBurst('#4CAF50'); // Green confetti

      setTimeout(nextWord, 1500);
    } else {
      // Wrong
      document.getElementById('feedback').innerHTML = "Try again!";
      document.getElementById('feedback').className = "wrong";
      speakCurrent(); // Repeat word
    }
  }

  function nextWord() {
    currentIndex++;
    if (currentIndex >= words.length) {
      victory();
    } else {
      updateProgress();
      document.getElementById('kidInput').value = '';
      document.getElementById('feedback').innerText = "Listening...";
      document.getElementById('feedback').className = "";
      speakCurrent();
    }
  }

  function updateProgress() {
    document.getElementById('currentNum').innerText = currentIndex + 1;
    const pct = ((currentIndex) / words.length) * 100;
    document.getElementById('progressBar').style.width = pct + "%";
  }

  function victory() {
    showScreen('winScreen');
    document.getElementById('snd_win').play();
    confettiBurst(); // Multicolor confetti
  }

  function editList() {
    showScreen('setupScreen');
  }

  function clearStorage() {
    if(confirm("Clear the saved list?")) {
      localStorage.removeItem('daddyDictationWords');
      document.getElementById('wordListInput').value = '';
    }
  }

  function showScreen(id) {
    document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
    document.getElementById(id).classList.add('active');
  }

  // --- VISUALS (Confetti) ---
  function confettiBurst(col = null) {
    const c = document.getElementById('confetti'); 
    c.style.display='block';
    c.width = window.innerWidth; 
    c.height = window.innerHeight;
    const ctx = c.getContext('2d');
    const cols = col ? [col] : ['#F44336','#2196F3','#FFEB3B','#4CAF50'];
    const p = Array.from({length: 200}, () => ({
      x: c.width/2, y: c.height/2,
      c: cols[Math.floor(Math.random()*cols.length)],
      a: Math.random() * Math.PI * 2,
      v: Math.random() * 10 + 5,
      s: Math.random() * 10 + 5
    }));
    
    let t=0;
    const anim = setInterval(()=>{
      ctx.clearRect(0,0,c.width,c.height);
      p.forEach(o => {
        o.x += Math.cos(o.a) * o.v; 
        o.y += Math.sin(o.a) * o.v + 4; 
        ctx.fillStyle = o.c; ctx.fillRect(o.x, o.y, o.s, o.s);
      });
      if(++t>60) { clearInterval(anim); c.style.display='none'; }
    }, 30);
  }
</script>
</body>
</html>
